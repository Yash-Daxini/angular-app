<div class="order-details-container">
  <!-- Loading State -->
  <div *ngIf="loading" class="loading-state">
    <div class="loading-spinner"></div>
    <p>Loading order details...</p>
  </div>

  <!-- Order Not Found -->
  <div *ngIf="!loading && !order" class="error-state">
    <div class="error-icon">
      <svg viewBox="0 0 24 24" fill="none" stroke="currentColor">
        <circle cx="12" cy="12" r="10"></circle>
        <line x1="15" y1="9" x2="9" y2="15"></line>
        <line x1="9" y1="9" x2="15" y2="15"></line>
      </svg>
    </div>
    <h2>Order Not Found</h2>
    <p>The order you're looking for doesn't exist or has been removed.</p>
    <button class="back-btn" (click)="goBack()">Go Back</button>
  </div>

  <!-- Order Details -->
  <div *ngIf="!loading && order" class="order-details-content">
    <!-- Header -->
    <div class="details-header">
      <button class="back-button" (click)="goBack()">
        <svg viewBox="0 0 24 24" fill="none" stroke="currentColor">
          <path
            stroke-linecap="round"
            stroke-linejoin="round"
            stroke-width="2"
            d="M15 18l-6-6 6-6"
          ></path>
        </svg>
        <span>Back to Orders</span>
      </button>

      <div class="header-content">
        <div class="order-title-section">
          <div class="title-info">
            <h1 class="order-id">{{ order.id }}</h1>
            <div class="order-badges">
              <div
                class="order-type-badge"
                [class.group-badge]="order.orderType === 'group'"
              >
                <span class="order-type-icon">{{
                  getOrderTypeIcon(order.orderType)
                }}</span>
                <span>{{ getOrderTypeLabel() }}</span>
              </div>
              <div
                class="status-badge"
                [ngClass]="getStatusClass(order.status)"
              >
                <svg
                  class="status-icon"
                  viewBox="0 0 24 24"
                  fill="none"
                  stroke="currentColor"
                >
                  <path
                    stroke-linecap="round"
                    stroke-linejoin="round"
                    stroke-width="2"
                    [attr.d]="getStatusIcon(order.status)"
                  ></path>
                </svg>
                <span>{{ order.status }}</span>
              </div>
            </div>
          </div>
        </div>

        <div class="header-actions">
          <div class="action-buttons-section">
            <button
              class="action-btn primary-btn"
              (click)="downloadReceipt()"
            >
              <svg viewBox="0 0 24 24" fill="none" stroke="currentColor">
                <path
                  stroke-linecap="round"
                  stroke-linejoin="round"
                  stroke-width="2"
                  d="M12 10v6m0 0l-3-3m3 3l3-3m2 0v5a2 2 0 01-2 2H7a2 2 0 01-2-2v-5m16-7V4a2 2 0 00-2-2H7a2 2 0 00-2 2v1m16 0V4"
                ></path>
              </svg>
              <span>Download Receipt</span>
            </button>
          </div>
        </div>
      </div>
    </div>

    <!-- Main Content Grid -->
    <div class="main-content">
      <!-- Order Items -->
      <div class="items-card">
        <div class="card-header">
          <svg
            class="card-icon"
            viewBox="0 0 24 24"
            fill="none"
            stroke="currentColor"
          >
            <path
              stroke-linecap="round"
              stroke-linejoin="round"
              stroke-width="2"
              d="M3 3h2l.4 2M7 13h10l4-8H5.4m0 0L7 13m0 0l-1.5 1.5M7 13l-1.5 1.5m0 0L9 18h6m-6 0a2 2 0 100 4 2 2 0 000-4zm8 0a2 2 0 100 4 2 2 0 000-4z"
            ></path>
          </svg>
          <h3>Order Items ({{ getTotalItems() }} items)</h3>
        </div>

        <!-- Individual Order Items -->
        <div *ngIf="order.orderType === 'individual'" class="items-list">
          <div
            *ngFor="let item of order.items; let i = index"
            class="food-item"
            [class.animated]="isItemAnimated(i)"
          >
            <div class="item-image">{{ item.image }}</div>
            <div class="item-details">
              <h4 class="item-name">{{ item.name }}</h4>
              <p class="item-category">{{ item.category }}</p>
              <div class="item-quantity">Qty: {{ item.quantity }}</div>
            </div>
            <div class="item-pricing">
              <div class="item-price">${{ item.price.toFixed(2) }}</div>
              <div *ngIf="item.quantity > 1" class="item-total">
                ${{ calculateItemTotal(item).toFixed(2) }} total
              </div>
            </div>
          </div>
        </div>

        <!-- Group Order Items -->
        <div
          *ngIf="order.orderType === 'group' && order.userOrders"
          class="group-items-list"
        >
          <div
            *ngFor="let userOrder of order.userOrders; let userIdx = index"
            class="user-order-section"
          >
            <div
              class="user-header"
              (click)="toggleUserExpanded(userOrder.userId)"
            >
              <div class="user-info">
                <div class="user-avatar">{{ userOrder.userAvatar }}</div>
                <div class="user-details">
                  <h4 class="user-name">{{ userOrder.userName }}</h4>
                  <p class="user-summary">
                    {{ userOrder.items.length }} items â€¢ ${{
                      userOrder.subtotal.toFixed(2)
                    }}
                  </p>
                </div>
              </div>
              <div class="expand-icon">
                <svg
                  *ngIf="expandedUser !== userOrder.userId"
                  viewBox="0 0 24 24"
                  fill="none"
                  stroke="currentColor"
                >
                  <polyline points="6,9 12,15 18,9"></polyline>
                </svg>
                <svg
                  *ngIf="expandedUser === userOrder.userId"
                  viewBox="0 0 24 24"
                  fill="none"
                  stroke="currentColor"
                >
                  <polyline points="18,15 12,9 6,15"></polyline>
                </svg>
              </div>
            </div>

            <div *ngIf="expandedUser === userOrder.userId" class="user-items">
              <div
                *ngFor="let item of userOrder.items; let itemIdx = index"
                class="food-item user-food-item"
                [class.animated]="isItemAnimated(userIdx * 10 + itemIdx)"
              >
                <div class="item-image">{{ item.image }}</div>
                <div class="item-details">
                  <h5 class="item-name">{{ item.name }}</h5>
                  <p class="item-category">{{ item.category }}</p>
                  <div class="item-quantity">Qty: {{ item.quantity }}</div>
                </div>
                <div class="item-pricing">
                  <div class="item-price">${{ item.price.toFixed(2) }}</div>
                  <div *ngIf="item.quantity > 1" class="item-total">
                    ${{ calculateItemTotal(item).toFixed(2) }} total
                  </div>
                </div>
              </div>
              <div class="user-subtotal">
                <span>{{ userOrder.userName }}'s Total: </span>
                <span class="subtotal-amount"
                  >${{ userOrder.subtotal.toFixed(2) }}</span
                >
              </div>
            </div>
          </div>
        </div>
      </div>

      <!-- Payment Information -->
      <div class="payment-card">
        <div class="card-header">
          <svg
            class="card-icon"
            viewBox="0 0 24 24"
            fill="none"
            stroke="currentColor"
          >
            <rect x="1" y="4" width="22" height="16" rx="2" ry="2"></rect>
            <line x1="1" y1="10" x2="23" y2="10"></line>
          </svg>
          <h3>Payment Information</h3>
        </div>

        <!-- Payment Methods -->
        <div *ngIf="hasMultiplePayments()" class="payment-methods">
          <h4>Payment Breakdown</h4>
          <div class="payment-list">
            <div
              *ngFor="let transaction of order.paymentTransactions"
              class="payment-item"
            >
              <div class="payment-method-info">
                <span class="payment-icon">{{ transaction.icon }}</span>
                <span class="payment-method">{{ transaction.method }}</span>
              </div>
              <div class="payment-amount" [style.color]="transaction.color">
                ${{ transaction.amount.toFixed(2) }}
              </div>
            </div>
          </div>
        </div>

        <div *ngIf="!hasMultiplePayments()" class="single-payment">
          <div class="payment-method-display">
            <span
              class="payment-icon"
              >{{ order.paymentTransactions?.[0]?.icon || 'ðŸ’³' }}</span
            >
            <span
              >{{ order.paymentTransactions?.[0]?.method || order.paymentMode }}</span
            >
          </div>
        </div>

        <!-- Order Summary -->
        <div class="order-summary">
          <div class="summary-line">
            <span>Subtotal</span>
            <span>${{ getSubtotal().toFixed(2) }}</span>
          </div>
          <div class="summary-line">
            <span>Delivery Fee</span>
            <span>$3.99</span>
          </div>
          <div
            class="summary-line taxes"
            *ngIf="order.orderType === 'individual'"
          >
            <span>Tax</span>
            <span>${{ (order.total * 0.08).toFixed(2) }}</span>
          </div>
          <div class="summary-line total">
            <span>Total Paid</span>
            <span>${{ order.total.toFixed(2) }}</span>
          </div>
        </div>
      </div>
    </div>
  </div>
</div>
